<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>1&nbsp; Text, Tokens, and Numbers – A Plain Walkthrough of Transformer Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./module-02.html" rel="next">
<link href="./overview.html" rel="prev">
<link href="./images/walk.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-a496c526c144800fb99e94ce0b766f38.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<meta name="mermaid-theme" content="default">
<script src="site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script type="module">
  import elkLayouts from 'https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0/dist/mermaid-layout-elk.esm.min.mjs';
  mermaid.registerLayoutLoaders(elkLayouts);
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./module-01.html">The One Mechanism</a></li><li class="breadcrumb-item"><a href="./module-01.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Text, Tokens, and Numbers</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./images/walk.png" alt="" class="sidebar-logo light-content py-0 d-lg-inline d-none">
      <img src="./images/walk.png" alt="" class="sidebar-logo dark-content py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">A Plain Walkthrough of Transformer Models</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">The One Mechanism</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module-01.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Text, Tokens, and Numbers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module-02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Fellowship of Tokens</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module-03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Into the Depths of Attention</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">The Twofold Training (TBD)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module-04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">module-04.html</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module-05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">module-05.html</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">The Three Wizards (TBD)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module-06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">module-06.html</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module-07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">module-07.html</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">The Appendices (TBD)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module-08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">module-08.html</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./module-09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">module-09.html</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#machines-need-numbers" id="toc-machines-need-numbers" class="nav-link active" data-scroll-target="#machines-need-numbers"><span class="header-section-number">1.1</span> Machines Need Numbers</a></li>
  <li><a href="#text-tokens-vectors" id="toc-text-tokens-vectors" class="nav-link" data-scroll-target="#text-tokens-vectors"><span class="header-section-number">1.2</span> Text → Tokens → Vectors</a>
  <ul class="collapse">
  <li><a href="#stage-1-the-breaking-of-the-text" id="toc-stage-1-the-breaking-of-the-text" class="nav-link" data-scroll-target="#stage-1-the-breaking-of-the-text"><span class="header-section-number">1.2.1</span> Stage 1: The Breaking of the Text</a></li>
  <li><a href="#stage-2-embedding" id="toc-stage-2-embedding" class="nav-link" data-scroll-target="#stage-2-embedding"><span class="header-section-number">1.2.2</span> Stage 2: Embedding</a></li>
  <li><a href="#stage-3-positional-encoding" id="toc-stage-3-positional-encoding" class="nav-link" data-scroll-target="#stage-3-positional-encoding"><span class="header-section-number">1.2.3</span> Stage 3: Positional Encoding</a></li>
  <li><a href="#the-journey-thus-far" id="toc-the-journey-thus-far" class="nav-link" data-scroll-target="#the-journey-thus-far"><span class="header-section-number">1.2.4</span> The Journey Thus Far</a></li>
  </ul></li>
  <li><a href="#the-ring-problem" id="toc-the-ring-problem" class="nav-link" data-scroll-target="#the-ring-problem"><span class="header-section-number">1.3</span> The “Ring” Problem</a>
  <ul class="collapse">
  <li><a href="#whats-missing" id="toc-whats-missing" class="nav-link" data-scroll-target="#whats-missing"><span class="header-section-number">1.3.1</span> What’s Missing?</a></li>
  <li><a href="#what-comes-next" id="toc-what-comes-next" class="nav-link" data-scroll-target="#what-comes-next"><span class="header-section-number">1.3.2</span> What Comes Next</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">1.4</span> Summary</a>
  <ul class="collapse">
  <li><a href="#the-pipeline-so-far" id="toc-the-pipeline-so-far" class="nav-link" data-scroll-target="#the-pipeline-so-far"><span class="header-section-number">1.4.1</span> The Pipeline So Far</a></li>
  <li><a href="#key-symbols" id="toc-key-symbols" class="nav-link" data-scroll-target="#key-symbols"><span class="header-section-number">1.4.2</span> Key Symbols</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./module-01.html">The One Mechanism</a></li><li class="breadcrumb-item"><a href="./module-01.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Text, Tokens, and Numbers</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Text, Tokens, and Numbers</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="machines-need-numbers" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="machines-need-numbers"><span class="header-section-number">1.1</span> Machines Need Numbers</h2>
<p><img src="images/horse.png" width="300"></p>
<p>Before a Transformer can answer questions or write novels, text must be turned into numbers. To a computer, text is not meaning — it is just a sequence of bytes.</p>
<p>Consider the word “horse.”</p>
<p>The letters h-o-r-s-e do not inherently imply a hoofed mammal that runs fast. In German, the same animal is “Pferd.” In Chinese, it is “馬.” The spellings are completely different, yet they refer to the same real-world creature — they are just <em>symbols</em> that represent the same concept.</p>
<p>Artificial neural networks, the core components of AI models, operate on numbers rather than not symbols. So before a model can process language, we must convert text into numbers.</p>
<p><strong>What We Need</strong></p>
<p>We need a systematic way to convert text into numerical vectors such that:</p>
<ol type="1">
<li>Every piece of text maps to a specific numerical representation.</li>
<li>The format is consistent (the model always receives the same input shape).</li>
</ol>
<p>This conversion process has three stages.</p>
</section>
<section id="text-tokens-vectors" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="text-tokens-vectors"><span class="header-section-number">1.2</span> Text → Tokens → Vectors</h2>
<p>Consider the input: <code>"the ring fell"</code></p>
<section id="stage-1-the-breaking-of-the-text" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="stage-1-the-breaking-of-the-text"><span class="header-section-number">1.2.1</span> Stage 1: The Breaking of the Text</h3>
<p>First, we must break the text into smaller units — <strong>tokens</strong> (For simplicity, think of it as individual words). Each token is then mapped to a unique integer ID via a static lookup table (the <em>vocabulary</em>).</p>
<p>This process is called <strong>tokenization</strong>.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">---
config:
  themeVariables:
    fontFamily: "monospace"
  flowchart:
    nodeSpacing: 8
    rankSpacing: 25
    padding: 10
---
flowchart BT
    Input("Raw Text&lt;br&gt;'the ring fell'")
    subgraph Tokenize[" Tokenization"]
        direction BT
        T1("the")
        T2("ring")
        T3("fell")
        ID1("101")
        ID2("205")
        ID3("310")
    end
    Output("Token IDs&lt;br&gt;[101, 205, 310]")
    
    Input --&gt; Tokenize --&gt; Output
    T1 -.-&gt; ID1
    T2 -.-&gt; ID2
    T3 -.-&gt; ID3    

    %% Styles
    style Input fill:#d8e2dc,stroke:#5b7065,color:#2a3630,stroke-width:2px
    style Tokenize fill:#fdf1b8,stroke:#9a832d,color:#4a3b2c
    style T1 fill:#fff,stroke:#4a3b2c
    style T2 fill:#fff,stroke:#4a3b2c
    style T3 fill:#fff,stroke:#4a3b2c
    style ID1 fill:#fff,stroke:#4a3b2c
    style ID2 fill:#fff,stroke:#4a3b2c
    style ID3 fill:#fff,stroke:#4a3b2c
    style Output fill:#e8dcc4,stroke:#4a3b2c,color:#4a3b2c
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>What is the “Vocabulary”?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In everyday language, vocabulary refers to the words a person knows. In NLP, the <strong>Vocabulary (<span class="math inline">\(V\)</span>)</strong> is the fixed, finite list of all unique tokens the model knows.</p>
<p>Think of it as a dictionary where every entry is assigned a specific number (ID).</p>
<ul>
<li><strong>Size:</strong> Typical vocabularies contain 30,000 to 100,000 unique tokens.</li>
<li><strong>Fixed:</strong> Once training starts, the vocabulary cannot change.</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Concerning Tokenization
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We can tokenize text in three ways:</p>
<ol type="1">
<li><strong>Character-level:</strong> Split “the” into <code>['T', 'h', 'e']</code>.
<ul>
<li><em>Issue:</em> Sequences become too long, and the model must learn spelling from scratch.</li>
</ul></li>
<li><strong>Word-level:</strong> Split “the ring fell” into <code>['the', 'ring', 'fell']</code>.
<ul>
<li><em>Issue:</em> The vocabulary explodes (hundreds of thousands of words), and unknown words like “riing” cause errors.</li>
</ul></li>
<li><strong>Subword-level (The Modern Standard):</strong>
<ul>
<li>Common words remain whole (“ring” → <code>['ring']</code>).</li>
<li>Rare words are split into meaningful chunks (“transformer” → <code>['trans', 'former']</code>).</li>
</ul></li>
</ol>
<p>Modern models use <strong>Subword Tokenization</strong>, which strikes a balance between vocabulary size and meaning.</p>
<p>Most models use <strong>Byte-Pair Encoding (BPE)</strong>. It starts with individual characters and iteratively merges the most frequent adjacent pairs until a target vocabulary size is reached (e.g., 50,000). This strikes the perfect balance between efficiency and meaning.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Note: Special Tokens
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Beyond words, models use special tokens to mark structure or unknown words:</p>
<ul>
<li><strong>[CLS]</strong>: Classification summary (BERT).</li>
<li><strong>[SEP]</strong>: Separator between sentences.</li>
<li><strong>[MASK]</strong>: Placeholder for prediction.</li>
<li><strong>[PAD]</strong>: Padding for batching.</li>
<li><strong>[UNK]</strong>: Unknown word.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="stage-2-embedding" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="stage-2-embedding"><span class="header-section-number">1.2.2</span> Stage 2: Embedding</h3>
<p>We cannot feed raw token IDs (e.g., <code>[101, 205, 310]</code>) directly into a neural network because they imply false mathematical relationships (e.g., 310 &gt; 101 suggests “fell” is somehow “greater than” “the”).</p>
<p>Instead, we convert each ID into a vector of numbers using an <strong>embedding matrix</strong>.</p>
<section id="what-is-the-embedding-matrix" class="level4">
<h4 class="anchored" data-anchor-id="what-is-the-embedding-matrix">What Is the Embedding Matrix?</h4>
<p>Think of the embedding matrix as a <strong>dictionary</strong>, but instead of definitions, each entry (i.e.&nbsp;each row) contains a list of numbers (an <strong>embedding vector</strong>), representing a token in the vocabulary:</p>
<p><span class="math display">\[
W_E \in \mathbb{R}^{|V| \times d_{model}}
\]</span></p>
<ul>
<li><span class="math inline">\(|V|\)</span> = vocabulary size (number of entries in the dictionary)</li>
<li><span class="math inline">\(d_{model}\)</span> = numbers of dimensions used to describe each token</li>
<li>We’ll use <span class="math inline">\(d_{model} = 4\)</span> throughout the book to keep examples consistent.</li>
</ul>
<p>For our sequence “the ring fell” (3 tokens), we look up 3 rows from <span class="math inline">\(W_E\)</span>:</p>
<p><span class="math display">\[
E = \begin{bmatrix}
0.1 &amp; 0.2 &amp; 0.3 &amp; 0.4 \\
0.5 &amp; 0.6 &amp; 0.7 &amp; 0.8 \\
0.2 &amp; 0.4 &amp; 0.6 &amp; 0.8
\end{bmatrix}
\begin{matrix}
\leftarrow \text{``the" (ID: 101)} \\
\leftarrow \text{``ring" (ID: 205)} \\
\leftarrow \text{``fell" (ID: 310)}
\end{matrix}
\]</span></p>
<p>Intuitively, each row represents a token’s unique <em>identity</em>—a numerical fingerprint that says <em>what</em> it is, but not yet <em>what it means here</em>.</p>
</section>
<section id="what-do-these-numbers-represent" class="level4">
<h4 class="anchored" data-anchor-id="what-do-these-numbers-represent">What Do These Numbers Represent?</h4>
<p>Each number in a token’s embedding vector describes the token along one <strong>dimension</strong> (a.k.a. <strong>feature</strong>). You can think of it like this: just as a person might be described (and thus identified) along multiple dimensions like <em>height</em>, <em>age</em>, <em>hair color</em>, a token is described along some learned dimensions.</p>
<p><img src="images/person-vs-token.png" class="img-fluid"></p>
<p>Note that the embedding matrix only helps us identify a token, but not understand it. For example, the vector for <code>ring</code> might encode properties like:</p>
<pre><code>common English word, 
can function as noun or verb, 
has certain phonetic properties, 
frequently co-occurs with words like X, Y, Z...</code></pre>
<p>But this vector doesn’t tell us whether “ring” means jewelry or sound in any particular sentence: Meaning requires <strong>context</strong>, which we don’t have yet.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Are Embedding Features Human-Interpretable?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Not really. Unlike a dictionary definition you can read, these features are <strong>learned patterns</strong> that emerge from training on massive amounts of text. Dimension 47 might correlate with “noun-ness” and dimension 203 with “abstract vs.&nbsp;concrete,” but we can’t easily inspect them.</p>
<p>What we <em>can</em> say: tokens with similar identities end up with similar vectors. “King” and “queen” will be closer together than “king” and “banana”—not because someone programmed royalty features, but because they appear in similar contexts during training.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Historical Note: Word2Vec and Static Embeddings
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The idea of representing words as vectors predates Transformers. In 2013, <strong>Word2Vec</strong> demonstrated that you could learn embeddings where arithmetic worked: <em>vector(“king”) - vector(“man”) + vector(“woman”) ≈ vector(“queen”)</em>.</p>
<p>These were revolutionary but <strong>static</strong>—each word had exactly one vector, regardless of context. The word “ring” would get a single embedding averaging across all its uses (jewelry, sound, boxing ring, tree ring…).</p>
<p>Transformers start with similar static embeddings but then <strong>update them based on context</strong>—which is exactly what the next chapter will introduce.</p>
</div>
</div>
</div>
</section>
</section>
<section id="stage-3-positional-encoding" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="stage-3-positional-encoding"><span class="header-section-number">1.2.3</span> Stage 3: Positional Encoding</h3>
<p>If we input “fell ring the” instead of “the ring fell,” the embedding matrix simply swaps rows. Because the Transformer processes all tokens simultaneously (<strong>permutation invariance</strong>), it cannot inherently distinguish “dog bites man” from “man bites dog.”</p>
<p><strong>The Solution:</strong> We inject position information by <strong>adding</strong> a position-specific vector (<span class="math inline">\(P\)</span>) to each token embedding (<span class="math inline">\(E\)</span>).</p>
<p><span class="math display">\[X = E + P\]</span></p>
<p>Now, each embedding in the ouput matrix, <span class="math inline">\(X\)</span>, captures <strong>what</strong> properties the token carries and <strong>where</strong> it is located. In the next chapter, we will see how transformers use this matrix to understand the text.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Technical Detail: The Math of Position
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Original Transformers used fixed sinusoidal functions:</p>
<p><span class="math display">\[PE_{(pos, 2i)} = \sin\left(\frac{pos}{10000^{2i/d_{model}}}\right)\]</span></p>
<p>This allows the model to learn relative positions (e.g., “attend to the word 3 steps back”). Modern models often use learned positional embeddings or Rotary Positional Embeddings (RoPE).</p>
<p><strong>Why Add and not Concatenate?</strong> Adding preserves dimensionality (<span class="math inline">\(d_{model}\)</span>) for efficiency. In high-dimensional space, semantic and positional information are easily separable by the model.</p>
</div>
</div>
</div>
</section>
<section id="the-journey-thus-far" class="level3" data-number="1.2.4">
<h3 data-number="1.2.4" class="anchored" data-anchor-id="the-journey-thus-far"><span class="header-section-number">1.2.4</span> The Journey Thus Far</h3>
<p>We have converted text into a numerical matrix <span class="math inline">\(X\)</span> of shape <span class="math inline">\((N \times d_{model})\)</span>.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">---
config: 
  themeVariables:
    fontFamily: "monospace"
  flowchart:
    nodeSpacing: 35
    rankSpacing: 25
    padding: 10
---
flowchart BT
    A("Raw Text&lt;br&gt;'the ring fell'")
    B[["Tokenization"]]
    C("Token IDs&lt;br&gt;")
    D[["Embedding Lookup"]]
    E("Token Embeddings (E)&lt;br&gt;(3 × d&lt;sub&gt;model&lt;/sub&gt;)")
    F("Position IDs&lt;br&gt;")
    G[["Positional Encoding"]]
    H("Position Vectors (P)&lt;br&gt;(3 × d&lt;sub&gt;model&lt;/sub&gt;)")
    I(("\+"))
    J("Matrix X&lt;br&gt;(3 × d&lt;sub&gt;model&lt;/sub&gt;)")

    A --&gt; B --&gt; C --&gt; D --&gt; E --&gt; I
    F --&gt; G --&gt; H --&gt; I
    I --&gt; J
    
    style A fill:#d8e2dc,stroke:#5b7065,color:#2a3630,stroke-width:2px
    style J fill:#d8e2dc,stroke:#5b7065,color:#2a3630,stroke-width:2px
    
    style B fill:#fdf1b8,stroke:#9a832d,color:#4a3b2c
    style D fill:#fdf1b8,stroke:#9a832d,color:#4a3b2c
    style G fill:#fdf1b8,stroke:#9a832d,color:#4a3b2c
    style I fill:#fdf1b8,stroke:#9a832d,color:#4a3b2c
   
    style C fill:#e8dcc4,stroke:#4a3b2c,color:#4a3b2c
    style E fill:#e8dcc4,stroke:#4a3b2c,color:#4a3b2c
    style F fill:#e8dcc4,stroke:#4a3b2c,color:#4a3b2c
    style H fill:#e8dcc4,stroke:#4a3b2c,color:#4a3b2c

</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
</section>
<section id="the-ring-problem" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="the-ring-problem"><span class="header-section-number">1.3</span> The “Ring” Problem</h2>
<p>We can now convert any text into a numerical matrix <span class="math inline">\(X\)</span>, where each token is represented by a row vector.</p>
<section id="whats-missing" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="whats-missing"><span class="header-section-number">1.3.1</span> What’s Missing?</h3>
<p><strong>There is no context</strong> in each token’s representation. Consider the word “ring”:</p>
<ol type="1">
<li>“The <strong>ring</strong> of the telephone woke her up.”</li>
<li>“He wore a golden <strong>ring</strong> on his finger.”</li>
</ol>
<p>In the first sentence, “ring” is a sound. In the second, it’s jewelry. Yet in our current pipeline, both instances map to the <strong>exact same vector</strong>. The embedding matrix has only one row for “ring”: a static representation that captures the “average” meaning of the word across all its uses.</p>
<p>This is the core limitation: each token’s vector is computed in isolation. It encodes identity and position, but nothing about surrounding tokens (the context). Whether “telephone” or “golden” appears nearby, the representation of “ring” doesn’t change. All possible meanings remain collapsed into a single point—and a model that can’t resolve such ambiguities will fail at basic comprehension.</p>
</section>
<section id="what-comes-next" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="what-comes-next"><span class="header-section-number">1.3.2</span> What Comes Next</h3>
<p>The next chapter introduces <strong>Self-Attention</strong>, the mechanism that finally incorporates context into each token’s representation.</p>
<p>For “ring,” this means:</p>
<ul>
<li>In “The ring of the telephone,” the presence of “telephone” pulls the representation of “ring” toward its sound-meaning.</li>
<li>In “He wore a golden ring,” the presence of “golden” pulls the representation of “ring” toward its jewelry-meaning.</li>
</ul>
<p>The static identity vectors we built here—the matrix <span class="math inline">\(X\)</span>—will be transformed into dynamic, contextual representations. Identity becomes <em>meaning</em>. But that is a tale for another chapter.</p>
</section>
</section>
<section id="summary" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="summary"><span class="header-section-number">1.4</span> Summary</h2>
<section id="the-pipeline-so-far" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="the-pipeline-so-far"><span class="header-section-number">1.4.1</span> The Pipeline So Far</h3>
<ol type="1">
<li><strong>Tokenization</strong>
<ul>
<li>Input: Raw text (<code>"the ring fell"</code>)</li>
<li>Output: Token IDs (<code>[101, 205, 310]</code>)</li>
</ul></li>
<li><strong>Embedding Lookup</strong>
<ul>
<li>Input: Token IDs</li>
<li>Output: Token embeddings <span class="math inline">\(E\)</span> with shape <span class="math inline">\((N \times d_{model})\)</span></li>
</ul></li>
<li><strong>Positional Encoding</strong>
<ul>
<li>Input: Position indices (<code>[0, 1, 2]</code>)</li>
<li>Output: Position vectors <span class="math inline">\(P\)</span> with shape <span class="math inline">\((N \times d_{model})\)</span></li>
</ul></li>
<li><strong>Addition</strong>
<ul>
<li>Input: <span class="math inline">\(E\)</span> and <span class="math inline">\(P\)</span></li>
<li>Output: Input matrix <span class="math inline">\(X\)</span> with shape <span class="math inline">\((N \times d_{model})\)</span></li>
</ul></li>
</ol>
</section>
<section id="key-symbols" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="key-symbols"><span class="header-section-number">1.4.2</span> Key Symbols</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Symbol</th>
<th>Name</th>
<th>Typical Shape</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(N\)</span></td>
<td>Sequence length</td>
<td>Scalar (e.g., 512, 2048)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(d_{model}\)</span></td>
<td>Model dimension</td>
<td>Scalar (e.g., 768, 4096)</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\|V\|\)</span></td>
<td>Vocabulary size</td>
<td>Scalar (e.g., 50,000)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(W_E\)</span></td>
<td>Embedding matrix</td>
<td><span class="math inline">\(\|V\| \times d_{model}\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(E\)</span></td>
<td>Token embeddings</td>
<td><span class="math inline">\(N \times d_{model}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(P\)</span></td>
<td>Positional encodings</td>
<td><span class="math inline">\(N \times d_{model}\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(X\)</span></td>
<td>Input matrix</td>
<td><span class="math inline">\(N \times d_{model}\)</span></td>
</tr>
</tbody>
</table>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./overview.html" class="pagination-link" aria-label="Overview">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Overview</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./module-02.html" class="pagination-link" aria-label="The Fellowship of Tokens">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Fellowship of Tokens</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p><a href="#">Back to Top <i class="bi bi-arrow-up"></i></a> <br> <br>Man Ho Wong, 2026. (<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en">CC BY-NC-SA 4.0</a>) <br><a href="https://github.com/manhowong/transformer-walkthrough/issues/new"><i class="bi bi-github"></i> Report an issue</a> <br></p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>